<!DOCTYPE html><html><head><title>textarea</title><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet"><style>html,body{margin:0;height:100%;overflow:hidden;font-family:sans-serif}#popup{position:fixed;top:10px;left:50%;transform:translateX(-50%);background:#fmfmfm;padding:30px;border-radius:1px;z-index:100}#closeBtn{position:absolute;top:1px;right:5px;cursor:pointer;font-weight:bold}#editorWrapper{position:relative;width:100%;height:100%}#editor{position:absolute;top:0;left:0;width:100%;height:100%;padding:0px;font-family:'Roboto Mono',monospace;background:transparent;color:black;caret-color:black;border:none;resize:none;overflow:auto;font-size:16px;white-space:pre;line-height:1.2}#editor:focus{outline:none}#codeBlock{position:absolute;top:0;left:0;width:100%;height:100%;padding:0px;overflow:auto;background:white;color:black;font-family:'Roboto Mono',monospace;white-space:pre;pointer-events:none;line-height:1.2}</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/vs2015.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script></head><body><div id="popup"><span id="closeBtn">Ã—</span><input id="peerIdInput" placeholder="Enter Peer ID"><button id="connectBtn">Connect</button><div id="myId">Your Peer ID :</div><div>,</div><div>you cannot join your own peer id btw</div></div><div id="editorWrapper"><textarea id="editor" spellcheck="false" wrap="off"></textarea><pre><code id="codeBlock" class="language-javascript"></code></pre></div><script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.7/dist/peerjs.min.js"></script><script>let e=document.getElementById("editor"),i=document.getElementById("peerIdInput"),b=document.getElementById("connectBtn"),m=document.getElementById("myId"),c=document.getElementById("closeBtn"),codeBlock=document.getElementById("codeBlock"),p=new Peer(),conns={},myId,lastValue="",lastHighlight="";function updateCode(){let t=e.value;codeBlock.textContent=t;if(t!==lastHighlight){lastHighlight=t;hljs.highlightElement(codeBlock)}codeBlock.scrollTop=e.scrollTop;codeBlock.scrollLeft=e.scrollLeft}function scheduleHighlight(){updateCode()}function sendToPeers(text){for(let k in conns)conns[k].send(JSON.stringify({text:text,path:[myId]}))}function handleLocalChange(){scheduleHighlight();let v=e.value;if(v!==lastValue){lastValue=v;sendToPeers(v)}}e.addEventListener("input",handleLocalChange);e.addEventListener("paste",handleLocalChange);e.addEventListener("scroll",()=>{requestAnimationFrame(()=>{codeBlock.scrollTop=e.scrollTop;codeBlock.scrollLeft=e.scrollLeft})});e.addEventListener("keydown",ev=>{if(ev.key==='Enter'){ev.preventDefault();let c=e.selectionStart,l=e.value.substring(0,c).split('\n').pop(),ind=l.match(/^\s*/)[0];e.setRangeText('\n'+ind,c,c,'end');scheduleHighlight();handleLocalChange()}});p.on("open",id=>{myId=id;m.innerText="Your Peer ID: "+id});p.on("connection",conn=>{conns[conn.peer]=conn;setup(conn)});b.onclick=()=>{let t=i.value.trim();if(!t)return alert("Enter a Peer ID to connect");if(t===myId)return alert("You cannot join your own Peer ID");if(!conns[t]){let n=p.connect(t);conns[t]=n;setup(n)}};c.onclick=()=>document.getElementById("popup").style.display="none";function cursorShift(o,n,c){let s=0,eo=o.length,en=n.length;while(s<eo&&s<en&&o[s]===n[s])s++;while(eo>s&&en>s&&o[eo-1]===n[en-1]){eo--;en--}return en-eo}function setup(conn){conn.on("open",()=>{if(e.value)conn.send(JSON.stringify({text:e.value,path:[myId]}));updateCode()});conn.on("data",d=>{let data=JSON.parse(d);if(data.path.includes(myId))return;let cur=e.selectionStart,shift=cursorShift(lastValue,data.text);e.value=data.text;lastValue=data.text;scheduleHighlight();e.selectionStart=e.selectionEnd=Math.max(0,Math.min(data.text.length,cur+shift));data.path.push(myId);for(let k in conns)if(!data.path.includes(k))conns[k].send(JSON.stringify({text:data.text,path:[...data.path]}))});conn.on("close",()=>delete conns[conn.peer])}setInterval(()=>{hljs.highlightElement(codeBlock)},5000);updateCode();</script></body></html>
