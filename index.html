<!DOCTYPE html><html><head><title>Collaborative Editor</title><style>html,body{margin:0;height:100%;overflow:hidden;font-family:sans-serif}#popup{position:fixed;top:10px;left:50%;transform:translateX(-50%);background:#fefefe;padding:30px;border-radius:5px;z-index:100}#closeBtn{position:absolute;top:1px;right:5px;cursor:pointer;font-weight:bold}#editor{width:100%;height:100%;font-size:16px;padding:3px}#editor:focus{outline:none}</style></head><body><div id="popup"><span id="closeBtn">âœ–</span><input id="peerIdInput" placeholder="Enter Peer ID"><button id="connectBtn">Connect</button><div id="myId">Your Peer ID :</div></div><textarea id="editor"></textarea><script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.7/dist/peerjs.min.js"></script><script>let e=document.getElementById("editor"),i=document.getElementById("peerIdInput"),b=document.getElementById("connectBtn"),m=document.getElementById("myId"),c=document.getElementById("closeBtn"),p=new Peer(),conns={},myId,lastValue="";p.on("open",id=>{myId=id;m.innerText="Your Peer ID: "+id});p.on("connection",conn=>{conns[conn.peer]=conn;setup(conn)});b.onclick=()=>{const t=i.value.trim();if(!t)return alert("Enter a Peer ID");if(t===myId)return alert("You cannot join your own Peer ID");if(!conns[t]){let newConn=p.connect(t);conns[t]=newConn;setup(newConn)}};c.onclick=()=>document.getElementById("popup").style.display="none";function setup(conn){conn.on("open",()=>{if(e.value)conn.send(JSON.stringify({text:e.value,path:[myId]}))});conn.on("data",data=>{let d=JSON.parse(data);if(d.path.includes(myId))return;let cursor=e.selectionStart;e.value=d.text;lastValue=d.text;e.selectionStart=e.selectionEnd=cursor;d.path.push(myId);for(let k in conns)if(!d.path.includes(k))conns[k].send(JSON.stringify({text:d.text,path:[...d.path]}))});conn.on("close",()=>delete conns[conn.peer])}e.addEventListener("input",()=>{let v=e.value;if(v!==lastValue){lastValue=v;for(let k in conns)conns[k].send(JSON.stringify({text:v,path:[myId]}))}})</script></body></html>
